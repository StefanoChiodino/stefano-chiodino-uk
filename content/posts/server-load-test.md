---
template: post
title: Server load test
slug: server-load-test
draft: false
date: 2016-05-14T14:50:14+01:00
description: Load testing a $5 Digitalocean server
category: Programming
tags:
  - server
  - nginx
  - digitalocean
  - https
  - brotli
  - load test
  - Programming
---
I've recently tried <a href="https://m.do.co/c/875cd23a5c97" target="_blank">Digitalocean</a> hosting and decided to host this blog on it. I'm running a $5 / month server, or droplet as they call it, with 1 CPU, 512 MB of ram, 20 GB SSD and 1 TB of bandwidth. You even get $10 credit when you sign up, sweet!

You may look down on a $5 machine but I've found it to be more than enough for my need.

I'm serving "static" content that has been generated by <a href="https://gohugo.io" target="_blank">Hugo</a>

I recently ran some load testing at work for a newly launched website so I decided to test this $5 server. I've been using <a href="https://loader.io" target="_blank">loader.io</a> since its basic usage is free.

## The test

The server responds to a certain number of clients every second for a full minute.

The majority of the users must receive the page in < 5 secs. Only the html is loaded.

## Plain HTML

10.000 requests a second! (that is the maximum that loaded.io goes on a free plan)

## Enable strong HTTPS

<a href="https://www.ssllabs.com/ssltest/analyze.html?d=https%3A%2F%2Fstefano.chiodino.uk" target="_blank" data-vivaldi-spatnav-clickable="1">How strong you say?</a>

As expected enabling https is taking its toll. The server can't accommodate less than half of the requests, "just" 4.000.

## Full on PageSpeed on strong HTTPS

I've then enabled Google's PageSpeed module for Nginx and enabled every performance related filter!

I've enabled 27 extra filters on top of the 34 enabled by default, leaving just 7 out that were just for compatibility or counterproductive, hell I've even enabled the filter to make the G analytics script async when it's already implemented that way.

Result: a quite dramatic 150 clients/sec ðŸ˜€

Here is the list of filters that I've enabled:

```nginx
pagespeed EnableFilters responsive_images;
pagespeed EnableFilters outline_css;
pagespeed EnableFilters outline_javascript;
pagespeed EnableFilters move_css_above_scripts;
pagespeed EnableFilters move_css_to_head;
pagespeed EnableFilters rewrite_style_attributes;
pagespeed EnableFilters prioritize_critical_css;
pagespeed EnableFilters make_google_analytics_async;
pagespeed EnableFilters canonicalize_javascript_libraries;
pagespeed EnableFilters inline_google_font_css;
pagespeed EnableFilters local_storage_cache;
pagespeed EnableFilters convert_to_webp_animated;
pagespeed EnableFilters insert_image_dimensions;
pagespeed EnableFilters inline_preview_images;
pagespeed EnableFilters resize_mobile_images;
pagespeed EnableFilters remove_comments;
pagespeed EnableFilters collapse_whitespace;
pagespeed EnableFilters elide_attributes;
pagespeed EnableFilters extend_cache_pdfs;
pagespeed EnableFilters sprite_images;
pagespeed EnableFilters rewrite_domains;
pagespeed EnableFilters trim_urls;
pagespeed EnableFilters remove_quotes;
pagespeed EnableFilters defer_javascript;
pagespeed EnableFilters dedup_inlined_images;
pagespeed EnableFilters lazyload_images;
pagespeed EnableFilters insert_dns_prefetch;
```

## Brotli (max compression)

Just add Accept-Encoding: br to loader.io request headers and... 75 clients / sec. Not bad considering that I've enabled the maximum (11) level of compression!

..and, if you are curious about the compression, my homepage file sizes are (method from <a href="https://hacks.mozilla.org/2015/11/better-than-gzip-compression-with-brotli" target="_blank">Mozilla's brotli post </a>):

<table>
<thead>
<tr>
<th>Algorithm</th>
<th>Size</th>
</tr>
</thead>
<tbody>
<tr>
<td>none</td>
<td>9508</td>
</tr>
<tr>
<td>gzip</td>
<td>3344</td>
</tr>
<tr>
<td>brotli</td>
<td>2732</td>
</tr>
</tbody>
</table>